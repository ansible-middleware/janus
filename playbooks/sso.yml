---
- ansible.builtin.import_playbook: janus.yml
  vars:
    post_processors_replacements:
      - match: "sso[.]service[.]j2"
        replace: "keycloak.service.j2"
        file: 'systemd[.]yml$'
      - match: "sso-sysconfig[.]j2"
        replace: "keycloak-sysconfig.j2"
        file: 'systemd[.]yml$'
      - match: "sso-service[.]sh[.]j2"
        replace: "keycloak-service.sh.j2"
        file: 'systemd[.]yml$'
      - match: 'cache-container name="sso" modules="org[.]sso[.]sso-model-infinispan"'
        replace: 'cache-container name="keycloak" modules="org.keycloak.keycloak-model-infinispan"'
        file: 'xml.j2$'
      - match: "org[.]sso[.]"
        replace: "org.keycloak."
      - match: "sso[.]org"
        replace: "keycloak.org"
      - match: "sso-server-subsystem"
        replace: "keycloak-server-subsystem"
        file: 'xml.j2$'
      - match: "[$][{]sso[.]"
        replace: "${keycloak."
      - match: "urn:jboss:domain:sso-server:1[.]1"
        replace: "urn:jboss:domain:keycloak-server:1.1"
        file: 'xml.j2$'
      - match: "start_sso[.]yml"
        replace: "start_keycloak.yml"
        file: '[.]yml$'
      - match: "stop_sso[.]yml"
        replace: "stop_keycloak.yml"
        file: '[.]yml$'
      - match: "java:jboss/infinispan/container/sso"
        replace: "java:jboss/infinispan/container/keycloak"
        file: 'xml.j2$'
      - match: 'local-cache name="sso"'
        replace: 'local-cache name="keycloak"'
        file: 'xml.j2$'
      - match: 'sso-database-update[.]sql'
        replace: 'keycloak-database-update.sql'
        file: 'xml.j2$'
      - match: '/bin/add-user-sso'
        replace: '/bin/add-user-keycloak'
        file: 'main[.]yml$'
    # anything inside <!--start {{ downstream_placeholder_delete }} --> and <!--end {{ downstream_placeholder_delete }} --> will be removed
    downstream_placeholder_delete: []
    # anything inside <!--start {{ downstream_placeholder_content }} --> and <!--end {{ downstream_placeholder_content }} --> will be replaced with content
    downstream_placeholder_content:
      - placeholder: support
        content: |
          ## Support
          
          redhat.sso collection v{{ downstream_version }} is a Beta release and for [Technical Preview](https://access.redhat.com/support/offerings/techpreview).
          If you have any issues or questions related to collection, please don't hesitate to contact us on Ansible-middleware-core@redhat.com or open an issue on 
          https://github.com/ansible-middleware/keycloak/issues
      - placeholder: rhn_credentials
        content: |
          ## Downloading from the Customer Portal

          The `redhat.sso.sso` role supports downloading and installing from the Red Hat Customer Portal, when the following variables are defined:
          ```
          rhn_username{{':'}} '<customer_portal_username>'
          rhn_password{{':'}} '<customer_portal_password>'
          ```